%token NUMBER STRING JOSI WORD COMMENT DEF_FUNC DEF_CLASS
%token IF THEN ELSE
%left '+' '-'
%left '*' '/' '%'
%left '&' '|'
%nonassoc UMINUS

%%
program : stmt_list { return lib_dic.commands['test'] + '\n' + $1; }
        ;

stmt_list : { $$ = '';}
		| stmt_list stmt { $$ = $1 + $2+ '\n';}
		;

stmt : assign { $$ = $1 + ';' }
		| funcall { $$ = $1 + ';' }
		| def_function
		| COMMENT
		;

assign : '@' WORD '=' expr { $$ = lib_dic.get_vars($2, '') + '=' + $4;}
		| '@' WORD '+' '=' expr { $$ = lib_dic.get_vars($2, '') + '+=' + $5;}
		| '@' WORD '-' '=' expr { $$ = lib_dic.get_vars($2, '') + '-=' + $5;}
		| '@' WORD '*' '=' expr { $$ = lib_dic.get_vars($2, '') + '*=' + $5;}
		| '@' WORD '/' '=' expr { $$ = lib_dic.get_vars($2, '') + '/=' + $5;}
		;

funcall : args WORD { $$ = lib_dic.get_comm($2, $1);}
		| WORD { $$ = lib_dic.get_comm($1,'');}
		;

def_function : DEF_FUNC WORD '{' stmt_list '}'
			{$$ = 'void ' + lib_dic.get_comm($2,'') + '{\n' + $4 + '}';}
		|DEF_FUNC WORD WORD '{' stmt_list '}'
			{$$ = $2 + ' ' + lib_dic.get_comm($3,'') + '{\n' + $5 + '}';}
		;

args : phrase
		| args phrase { $$ = $1 + ',' + $2;}
		;

phrase : '{' phrase_part '}' JOSI { $$ = $2 }
		;

phrase_part : WORD ':' expr { $$ = $3 }
		| phrase_part ',' WORD ':' expr { $$ = $1 + ',' + $5 }
		;

expr : expr '+' expr { $$ = $1 + '+' + $3; }
		| expr '-' expr { $$ = $1 + '-' + $3; }
		| expr '*' expr { $$ = $1 + '*' + $3; }
		| expr '/' expr { $$ = $1 + '/' + $3; }
		| expr '%' expr { $$ = $1 + '%' + $3; }
		| expr '&' '&' expr { $$ = $1 + '&&' + $4; }
		| expr '|' '|' expr { $$ = $1 + '||' + $4; }
		| expr '<' expr { $$ = $1 + '<' + $3; }
		| expr '>' expr { $$ = $1 + '>' + $3; }
		| expr '<' '=' expr { $$ = $1 + '<=' + $4; }
		| expr '>' '=' expr { $$ = $1 + '>=' + $4; }
		| expr '!' '=' expr { $$ = $1 + '!=' + $4; }
		| '(' expr ')' { $$ = '(' + $2 + ')'; }
		| '@' WORD {$$ = lib_dic.get_vars($2, '')}
		| '-' expr %prec UMINUS {$$ = '-' + $2} 
		| '!' expr {$$ = '!' + $2} 
		| funcall
		| primary
		;

primary : NUMBER
		| STRING
		;

%%
