%token NUMBER STRING JOSI WORD COMMENT

%left '+' '-'
%left '*' '/' '%'

%%
program : stmt_list { return lib_dic.commands['test'] + '\n' + $1; }
        ;

stmt_list : { $$ = '';}
		| stmt_list stmt { $$ = $1 + $2+ '\n';}
		;

stmt : assign { $$ = $1 + ';' }
		| funcall { $$ = $1 + ';' }
		| def_function
		| COMMENT
		;

assign : WORD '=' expr { $$ = $1 + '=' + $3;}
		;

funcall : args WORD { $$ = lib_dic.get_comm($2, $1);}
		| WORD { $$ = lib_dic.get_comm($1,'');}
		;

def_function : '-' '-' '-' WORD '{' stmt_list '}' 
			{$$ = 'void ' + lib_dic.get_comm($4,'') + '{\n' + $6 + '}';}
		|'-' '-' '-' WORD WORD '{' stmt_list '}' 
			{$$ = $4 + ' ' + lib_dic.get_comm($5,'') + '{\n' + $7 + '}';}
		;

args : phrase
		| args phrase { $$ = $1 + ',' + $2;}
		;

phrase : '{' phrase_part '}' JOSI { $$ = $2 }
		;

phrase_part : WORD ':' expr { $$ = $3 }
		| phrase_part ',' WORD ':' expr { $$ = $1 + ',' + $5 }
		;

expr : expr '+' expr { $$ = $1 + '+' + $3; }
		| expr '-' expr { $$ = $1 + '-' + $3; }
		| expr '*' expr { $$ = $1 + '*' + $3; }
		| expr '/' expr { $$ = $1 + '/' + $3; }
		| expr '%' expr { $$ = $1 + '%' + $3; }
		| '(' expr ')' { $$ = '(' + $2 + ')'; }
		| funcall
		| primary
		;

primary : NUMBER
		| STRING
		;

%%
