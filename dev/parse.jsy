%token NUMBER STRING JOSI WORD COMMENT

%left '+' '-'
%left '*' '/' '%'
%left '^'

%%
program : stmt_list { return commands.dic['test'] + '\n' + $1; }
        ;

stmt_list : { $$ = '';}
		| stmt_list stmt { $$ = $1 + $2+ '\n';}
		;

stmt : assign { $$ = $1 + ';' }
		| funcall { $$ = $1 + ';' }
		| COMMENT
		;

assign : WORD '=' expr { $$ = $1 + '=' + $3;}
		;

funcall : args WORD { $$ = commands.get($2) + '(' + $1 + ')';}
		| WORD { $$ = commands.get($1) + '()';}
		;

args : phrase
		| args phrase { $$ = $1 + ',' + $2;}
		;

phrase : '{' phrase_part '}' JOSI { $$ = $2 }
		;

phrase_part : WORD ':' expr { $$ = $3 }
		| phrase_part ',' WORD ':' expr { $$ = $1 + ',' + $5 }
		;

expr : expr '+' expr { $$ = $1 + '+' + $3; }
		| expr '-' expr { $$ = $1 + '-' + $3; }
		| expr '*' expr { $$ = $1 + '*' + $3; }
		| expr '/' expr { $$ = $1 + '/' + $3; }
		| expr '%' expr { $$ = $1 + '%' + $3; }
		| '(' expr ')' { $$ = '(' + $2 + ')'; }
		| funcall
		| primary
		;

primary : NUMBER
		| STRING
		;

%%
